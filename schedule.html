<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Specials Schedule</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { color: #2a5d84; }
    .student-block { margin-bottom: 40px; }
    .daily-card {
      background: #f0f8ff;
      border: 1px solid #cce;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      font-size: 1.2em;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f9f9f9; }
    .today-row { background-color: #ffffcc; }
    select { padding: 5px; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h2>Specials Schedule</h2>

  <div class="student-block">
    <h3>Child 1</h3>
    <label for="homeroom1">Choose Homeroom:</label>
    <select id="homeroom1"></select>
    <div id="daily1" class="daily-card"></div>
    <div id="schedule1"></div>
  </div>

  <div class="student-block">
    <h3>Child 2</h3>
    <label for="homeroom2">Choose Homeroom:</label>
    <select id="homeroom2"></select>
    <div id="daily2" class="daily-card"></div>
    <div id="schedule2"></div>
  </div>

  <script>
    const calendarUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vThlCcG-UjJPsj0VqjrRCeP9dlrGpzbh9aeV7q7mTniPBNWF61UvQHLb9N_uq-GH_NjQxqVnqtJa86U/pub?gid=0&single=true&output=csv";
    const homeroomsUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vThlCcG-UjJPsj0VqjrRCeP9dlrGpzbh9aeV7q7mTniPBNWF61UvQHLb9N_uq-GH_NjQxqVnqtJa86U/pub?gid=414191937&single=true&output=csv";

    let calendarData = [];
    let homeroomData = {};

    async function loadCSV(url) {
      const response = await fetch(url);
      const text = await response.text();
      return Papa.parse(text, { header: true }).data;
    }

    async function loadData() {
      try {
        const [calendar, homerooms] = await Promise.all([
          loadCSV(calendarUrl),
          loadCSV(homeroomsUrl)
        ]);
        calendarData = calendar.map(row => ({
          date: row["Date"],
          day: row["Day"],
          dow: row["Day of the week"]
        }));
        homerooms.forEach(row => {
          homeroomData[row["Homeroom"]] = row;
        });
        populateDropdown("homeroom1", "daily1", "schedule1");
        populateDropdown("homeroom2", "daily2", "schedule2");
      } catch (err) {
        document.body.insertAdjacentHTML("afterbegin", `<p style="color:red">Error during loadData: ${err}</p>`);
        console.error("Error loading CSVs:", err);
      }
    }

    function populateDropdown(selectId, dailyId, scheduleId) {
      const select = document.getElementById(selectId);
      select.innerHTML = `<option value="">--Select--</option>`;
      Object.keys(homeroomData).forEach(h => {
        const opt = document.createElement("option");
        opt.value = h;
        opt.textContent = h;
        select.appendChild(opt);
      });
      select.addEventListener("change", () => {
        renderViews(select.value, dailyId, scheduleId);
      });
    }

    function renderViews(homeroom, dailyId, scheduleId) {
      const dailyDiv = document.getElementById(dailyId);
      const scheduleDiv = document.getElementById(scheduleId);
      if (!homeroom) {
        dailyDiv.innerHTML = "";
        scheduleDiv.innerHTML = "";
        return;
      }

      const today = new Date();
      today.setHours(0,0,0,0);

      // find today's row
      const todayRow = calendarData.find(row => {
        const d = new Date(row.date);
        return d.getTime() === today.getTime();
      });

      if (todayRow) {
        let special = "No school";
        if (!isNaN(todayRow.day)) {
          special = homeroomData[homeroom]["Day" + todayRow.day];
        }
        dailyDiv.innerHTML = `<strong>${todayRow.dow}</strong> | Date: ${todayRow.date} | Day: ${todayRow.day} | Special: ${special}`;
      } else {
        dailyDiv.innerHTML = "No data for today";
      }

      // next 6 days table
      let html = "<table><tr><th>Day of Week</th><th>Date</th><th>Day</th><th>Special</th></tr>";
      for (let i = 0; i < 6; i++) {
        const d = new Date(today);
        d.setDate(today.getDate() + i);
        const row = calendarData.find(r => {
          const rd = new Date(r.date);
          return rd.getTime() === d.getTime();
        });
        if (row) {
          let special = "No school";
          if (!isNaN(row.day)) {
            special = homeroomData[homeroom]["Day" + row.day];
          }
          const isToday = i === 0 ? " class='today-row'" : "";
          html += `<tr${isToday}><td>${row.dow}</td><td>${row.date}</td><td>${row.day}</td><td>${special}</td></tr>`;
        }
      }
      html += "</table>";
      scheduleDiv.innerHTML = html;
    }

    // Load PapaParse for CSV parsing
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script>
    loadData();
  </script>
</body>
</html>
