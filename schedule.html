<!DOCTYPE html>
<html>
<head>
  <title>6-Day Specials Schedule</title>
  <meta charset="utf-8"/>
  <style>
    body { font-family: Arial, sans-serif; padding: 18px; }
    select { margin: 10px; padding: 6px; }
    table { border-collapse: collapse; margin-top: 10px; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f4f4f4; }
    .student-block { border: 2px solid #ddd; border-radius: 8px; padding: 15px; margin: 20px 0; }
    .today-row { background-color: #ffffcc; font-weight: bold; }
    .daily-card {
      background-color: #e6f7ff;
      border: 2px solid #99d6ff;
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      font-size: 1.15em;
      text-align: center;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.08);
    }
    .daily-card b { color: #005580; }
  </style>
</head>
<body>
  <h2>Specials Schedule</h2>

  <div class="student-block">
    <h3>Child 1</h3>
    <label for="homeroom1">Choose Homeroom:</label>
    <select id="homeroom1"></select>
    <div id="dailyView1"></div>
    <div id="weeklyView1"></div>
  </div>

  <div class="student-block">
    <h3>Child 2</h3>
    <label for="homeroom2">Choose Homeroom:</label>
    <select id="homeroom2"></select>
    <div id="dailyView2"></div>
    <div id="weeklyView2"></div>
  </div>

  <script>
    const calendarUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vThlCcG-UjJPsj0VqjrRCeP9dlrGpzbh9aeV7q7mTniPBNWF61UvQHLb9N_uq-GH_NjQxqVnqtJa86U/pub?gid=0&single=true&output=csv";
    const homeroomsUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vThlCcG-UjJPsj0VqjrRCeP9dlrGpzbh9aeV7q7mTniPBNWF61UvQHLb9N_uq-GH_NjQxqVnqtJa86U/pub?gid=414191937&single=true&output=csv";

    let calendar = {};
    let homerooms = {};
    let allDates = [];

    function formatDateMMDDYYYY(d) {
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const dd = String(d.getDate()).padStart(2, '0');
      const yyyy = d.getFullYear();
      return `${mm}/${dd}/${yyyy}`;
    }

    function dateFromMDY(norm) {
      if (!norm || typeof norm !== 'string') return new Date(NaN);
      const parts = norm.split('/');
      if (parts.length !== 3) return new Date(norm);
      const mm = parseInt(parts[0], 10);
      const dd = parseInt(parts[1], 10);
      const yyyy = parseInt(parts[2], 10);
      return new Date(yyyy, mm - 1, dd);
    }

    function normalizeDateString(s) {
      if (!s && s !== 0) return "";
      s = String(s).trim().replace(/^"|"$/g, '');
      if (/^\d{4}-\d{1,2}-\d{1,2}$/.test(s)) {
        const [y,m,d] = s.split("-");
        return `${String(m).padStart(2,'0')}/${String(d).padStart(2,'0')}/${y}`;
      }
      if (/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(s)) {
        const parts = s.split("/");
        let a = parseInt(parts[0],10), b = parseInt(parts[1],10), y = parts[2];
        if (a > 12 && b <=12) { const tmp = a; a = b; b = tmp; }
        return `${String(a).padStart(2,'0')}/${String(b).padStart(2,'0')}/${y}`;
      }
      const d = new Date(s);
      if (!isNaN(d.getTime())) return formatDateMMDDYYYY(d);
      return s;
    }

    function splitCsvLine(line) {
      const out = [];
      let cur = "", inQuotes = false;
      for (let i=0; i<line.length; i++) {
        const ch = line[i];
        if (ch === '"') {
          if (inQuotes && line[i+1] === '"') { cur += '"'; i++; }
          else { inQuotes = !inQuotes; }
        } else if (ch === ',' && !inQuotes) {
          out.push(cur);
          cur = "";
        } else {
          cur += ch;
        }
      }
      out.push(cur);
      return out;
    }

    function parseCsv(text) {
      const lines = text.replace(/\r/g,'').split('\n').filter(l => l.trim() !== "");
      return lines.map(splitCsvLine);
    }

    async function loadData() {
      try {
        const calResp = await fetch(calendarUrl);
        const calText = await calResp.text();
        const calRows = parseCsv(calText);
        const headers = calRows[0].map(h => (h||"").toString().trim().toLowerCase());
        let dateIdx = headers.findIndex(h => h.includes('date'));
        let dayIdx  = headers.findIndex(h => h === 'day');
        let dowIdx  = headers.findIndex(h => h.includes('week'));
        calendar = {};
        allDates = [];
        for (let i=1; i<calRows.length; i++) {
          const row = calRows[i];
          const rawDate = row[dateIdx] || "";
          const rawDay  = row[dayIdx]  || "";
          const rawDow  = row[dowIdx]  || "";
          const norm = normalizeDateString(rawDate);
          let dayVal = /^[1-6]$/.test(rawDay.trim()) ? parseInt(rawDay.trim(), 10) : null;
          calendar[norm] = { day: dayVal, dow: rawDow.trim() };
          allDates.push(norm);
        }
        allDates.sort((a,b) => dateFromMDY(a) - dateFromMDY(b));

        const hrResp = await fetch(homeroomsUrl);
        const hrText = await hrResp.text();
        const hrRows = parseCsv(hrText);
        homerooms = {};
        for (let i=1; i<hrRows.length; i++) {
          const row = hrRows[i];
          const key = row[0] ? String(row[0]).trim() : `Row${i}`;
          homero
